<h1><a id="apigateway">Deploying the API Gateway</a></h1>
<p>
    The work done to this point creates the global Octopus resources required to support a deployment of applications and infrastructure to AWS. With this done we are now able to deploy the API Gateway instance that exposes our Lambda microservices.
</p>
<p>
    The API Gateway provides a shared entry point for web clients interacting with the microservices that make up the Octopub sample application. Because it is a shared resource, it is deployed as a separate project in its own CloudFormation stack. We'll make use of CloudFormation output variables to allow subsequent AWS resources to attach themselves to the API Gateway.
</p>
<p>
    To create the API Gateway deployment project in Octopus, apply the Terraform configuration in the <strong>terraform/apigateway/octopus</strong> directory using the following commands:
</p>
<pre>cd terraform/apigateway/octopus
terraform init
terraform apply</pre>
<p>
    You will be prompted for the URL of your Octopus instance, the Octopus API key, the ID of the space to apply the configuration to, the AWS access key, and the AWS secret key. Terraform then displays a list of changes and prompts you to apply them. Once the configuration is applied a project called <strong>API Gateway</strong> with a single <strong>Deploy an AWS CloudFormation template</strong> step is created:
</p>
<div><img alt="Octopus environments" src="images/octopus/apigateway.png"/></div>
<p>
    Deploying this project creates an new API Gateway instance in AWS with a number of API Gateway resources exposing the <strong>api</strong> and <strong>health</strong> endpoints, and with a proxy resource matching all other requests made under the root resource:
</p>
<div><img alt="Octopus environments" src="images/octopus/apigatewayaws.png"/></div>
<p>
    The CloudFormation stack responsible for creating the API Gateway exposes a number of output variables. Subsequent Lambda deployments will read these variables to attach the Lambda and front end web app to the API Gateway:
</p>
<div><img alt="Octopus environments" src="images/octopus/apigatewaycfoutputs.png"/></div>
<p>
    With the API Gateway configured, the next step is to deploy the backend REST API microservice as a Lambda.
</p>
